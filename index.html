<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//ES" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, usr-scalable=no, minimal-ui">
<title>CDM Internacional</title>
<link href="css/main.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700" rel="stylesheet" type="text/css">
<link href="js/jquery.mobile-1.4.5.min.css" rel="stylesheet" type="text/css" />
<script src="js/jquery-1.11.1.min.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type='text/javascript' src='js/infinite-rotator.js'></script>
<script src="js/connectionstatus.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).bind("mobileinit", function(){
  $.mobile.defaultPageTransition="slide";
  $.mobile.allowCrossDomainPages = true;
});

var streamingUrl="http://unoredcdn.net/radiocdm/myStream.sdp/playlist.m3u8";
 
</script>
<script src="js/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
</head>
<body>
<div data-role="page"  id="home">
	<div data-role="header" data-position="fixed" data-tap-toggle="false" id="myheader" align="center">
		<img src="images/logo.png"/>
	</div>
	<div id="content" >
		 <ul id="menu-list">
			<li><a href="#tv"><img src="images/video.png"/>Televisión</a></li>
			<li><a href="#radio"><img src="images/audio.png"/>Radio</a></li>
			<li><a href="#" class="call"><img src="images/call_2.png"/>Llamar</a></li>
			<li><a href="#" class="contact"><img src="images/email.png"/>Email</a></li>
			<li><a href="#schedule"><img src="images/schedule.png"/>Programación</a></li>
			<li><a href="#website"><img src="images/web.png"/>Sitio Web</a></li>
			<li><a href="#donation"><img src="images/donation.png"/>Donar</a></li>
			<li><a href="#notification"><img src="images/notification.png"/>Notificaciones</a></li>
			<li><a href="#facebook"><img src="images/facebook.png"/>Facebook</a></li>
			<li><a href="#youtube"><img src="images/youtube.png"/>YouTube</a></li>
		</ul>
	</div>
	<div id="ads">
			<div id="imgslide">
				<script type="text/javascript"> 
					var output="";
					$.getJSON("http://www.rockapr.com/site/slideshowjson.php",function(adsdata){ 
						for(adsi in adsdata){
						output+='<a href="#" class="rotating-item" onclick="window.open(\''+adsdata[adsi].banner_link+'\');"><img src="'+adsdata[adsi].banner_img+'" alt="'+adsdata[adsi].banner_title+'"  title="'+adsdata[adsi].banner_title+'"></a>';	
						}			
						$('#rotating-item-wrapper').append(output);	
					});
				</script>
				<div id="rotating-item-wrapper"></div>
			</div>
		</div>
</div>
<div data-role="page" id="tv">
	<div data-role="header" data-position="fixed" data-tap-toggle="false" id="myheader" align="center">
		<a class="back-btn" href="#home" data-direction="reverse" data-role="none"><img src="images/back-btn.png"/></a>
		<h3>CDM TV</h3>
	</div>	
	<div data-role="content" >
		<img  src="images/cdmtv_logo.jpg"/>
		<div data-role="navbar">
			<ul>
				<li><a href="#"><img onClick="tvOn();" class="play-btn" src="images/play.png"/></a></li>
			</ul>
		</div>
	</div>
</div>
<div data-role="page" id="radio">
	<div data-role="header" data-position="fixed" data-tap-toggle="false" id="myheader" align="center">
		<a class="back-btn" href="#home" data-direction="reverse" data-role="none"><img src="images/back-btn.png"/></a>
		<h3>CDM Radio</h3>
	</div>	
	<div data-role="content" >
		<img  src="images/logo_radio.jpg"/>
		<div data-role="navbar">
			<ul>
				<li><a href="#"><img onClick="play();" class="play-btn" src="images/play.png"/></a></li>
				<li><a href="#"><img class="call-btn call" src="images/call.png"/></a></li>
			</ul>
		</div>
	</div>
</div>
<script type="text/javascript" charset="utf-8">
$('.call').on("click",function(){
		window.location.href = "tel:7872625400";
	});
$('.contact').on("click",function(){
	window.location.href = "mailto:";
});
document.addEventListener("deviceready", onDeviceReady, false);
var myMedia = null;
var playing = false;
function onDeviceReady(){
	updateMedia();
	playAudio();
}
//notifications
document.addEventListener('deviceready', function () {
	var notificationOpenedCallback = function(jsonData) {
		if (jsonData.additionalData) {
				if (jsonData.additionalData.nurl)
				  window.location.href = jsonData.additionalData.nurl;
			  }
		navigator.notification.alert(jsonData.message, alertDismissed,'CDM Internacional', 'Ok')
	};
	window.plugins.OneSignal.init("000bb786-3469-11e5-b564-f3a7b95de935",
					   {googleProjectNumber: "534619972153"},
					   notificationOpenedCallback);
	window.plugins.OneSignal.enableNotificationsWhenActive(false);
	window.plugins.OneSignal.enableSound(true);
	window.plugins.OneSignal.enableVibrate(false);
},false); 
function updateMedia() {
	myMedia = new Media('http://unoredcdn.net/radiocdm/myStream.sdp/playlist.m3u8', stopAudio, null);
}
function playAudio() {
	if (!playing) {
		myMedia.play();
		document.getElementById('play').src = "images/activityindicator.gif"; 
		progressTimer = setInterval(function() {
			myMedia.getCurrentPosition(
				function(position) {
					if (position > 0) {
						document.getElementById('play').src = "images/stop.png";
						playing = true;
					}
				},
				// error callback
				function(e) {
				//console.log("Error getting pos " + e);
				}
			);
		}, 1000);
	} else {
		myMedia.stop();
		myMedia.release();
		document.getElementById('play').src = "images/play.png";    
		playing = false; 
	}
}
function stopAudio() {
	myMedia.stop();
	myMedia.release();
	playing = false;
	document.getElementById('play').src = "images/play.png";     
}
var video;
function tvOn(){
	stopAudio();
	 var videoUrl = "rtmp://unoredcdn.net:1935/cadenadelmilagro";

	  // Just play a video
	  window.plugins.streamingMedia.playVideo(videoUrl);

	  // Play a video with callbacks
	  var options = {
		successCallback: function() {
		  console.log("Video was closed without error.");
		},
		errorCallback: function(errMsg) {
		  console.log("Error! " + errMsg);
		}
	  };
	  window.plugins.streamingMedia.playVideo(videoUrl, options);
}
function tvOff(){
	//$('#rockahdvideo').get(0).pause();
	playAudio();
}
document.addEventListener("backbutton", function(e){
	if($.mobile.activePage.is('#home')){
	 //window.location = "#exitDialog";
		exitAppPopup();
	}else{
	   navigator.app.backHistory();
	};
});
	function exitAppPopup() {
		navigator.notification.confirm(
		"¿Seguro que deseas salir?", 
		function(buttonIndex){
			ConfirmExit(buttonIndex);
		}, 
		"Cerrar aplicación", 
		"Si,No"
		); 
	//return false;
	};

	function ConfirmExit(stat){
	if(stat == "1"){
		stopAudio();
		navigator.app.exitApp();
		
		}else{
			return;
		};
	};
</script>
</body>
</html>